# 复活点系统设置指南

## 概述
本复活点系统使用Map中的animated objects中的trap实现复活点功能。玩家可以通过E键与复活点交互，复活点从静止状态切换到播放动画，角色死亡或掉落出地图时会复活在最近的已激活复活点。

## 系统组成

### 1. 核心脚本
- `RespawnManager.cs` - 复活点管理器（单例）
- `RespawnPoint.cs` - 复活点脚本
- `TrapRespawnPointAnimator.cs` - Trap动画控制器
- `InteractionPrompt.cs` - 交互提示UI

### 2. 主要功能
- E键激活复活点
- 复活点从静止到播放动画
- 选择最近的已激活复活点进行复活
- 地图边界掉落检测
- 复活时的无敌时间和特效

## 设置步骤

### 第一步：设置复活点管理器

1. 在场景中创建一个空的GameObject，命名为"RespawnManager"
2. 添加`RespawnManager`脚本
3. 配置参数：
   ```
   复活设置:
   - Invincibility Time: 2.0 (复活后无敌时间)
   - Respawn Effect: (复活特效预制件，可选)
   - Respawn Sound: (复活音效，可选)
   - Map Bottom Boundary: -10.0 (地图下边界Y坐标)
   - Default Respawn Position: (0,0,0) (默认复活位置)
   
   调试信息:
   - Show Debug Info: true (显示调试信息)
   ```

### 第二步：设置Trap复活点

1. 在场景中放置Trap对象（使用Map/4 Animated objects/Trap的sprite）
2. 为Trap对象添加以下组件：
   - `Animator` (使用现有的Trap动画控制器)
   - `RespawnPoint` 脚本
   - `TrapRespawnPointAnimator` 脚本
   - `Collider2D` (作为触发器)

3. 配置`RespawnPoint`脚本：
   ```
   复活点设置:
   - Respawn Point ID: "RespawnPoint_01" (唯一ID)
   - Respawn Offset: (0, 1, 0) (复活偏移量)
   - Interaction Range: 2.0 (交互范围)
   - Activation Sound: (激活音效，可选)
   - Activation Effect: (激活特效，可选)
   
   动画设置:
   - Animator: (拖拽Trap的Animator组件)
   - Activation Trigger: "Activate" (激活触发器名称)
   - Loop Animation: true (循环播放动画)
   
   交互提示:
   - Interaction Prompt: (提示UI预制件，可选)
   - Prompt Text: "按 E 键激活复活点"
   ```

4. 配置`TrapRespawnPointAnimator`脚本：
   ```
   Trap动画设置:
   - Trap Animator: (拖拽Animator组件)
   - Idle Animation Name: "Trap_Idle" (静止动画名称)
   - Active Animation Name: "SpikeExtendRetract" (激活动画名称)
   - Activation Trigger: "Activate" (激活触发器)
   - Loop Active Animation: true (循环播放激活动画)
   - Active Animation Speed: 1.0 (动画播放速度)
   ```

### 第三步：配置Trap动画控制器

1. 确保Trap的Animator Controller包含以下状态：
   - 默认静止状态（动画速度为0）
   - SpikeExtendRetract状态（循环播放）
   - Activate触发器用于状态转换

2. 设置状态转换：
   ```
   静止状态 -> SpikeExtendRetract状态
   条件: Activate触发器
   
   添加Bool参数: IsActive
   当IsActive为true时，保持在SpikeExtendRetract状态
   ```

### 第四步：设置玩家

1. 确保玩家GameObject有`Player`标签
2. 确保玩家有以下组件之一：
   - `PlayerController`脚本（用于基础移动和血量管理）
   - `PlayerAttackSystem`脚本（用于攻击和血量管理）
3. 系统会自动检测玩家死亡和掉落边界

**重要说明：**
- 如果使用`PlayerAttackSystem`，系统会自动处理死亡时的复活逻辑
- 如果同时有`PlayerController`和`PlayerAttackSystem`，优先使用`PlayerAttackSystem`的血量系统
- 复活时会同时恢复两个组件的血量

### 第五步：创建交互提示UI（可选）

1. 创建一个UI预制件作为交互提示
2. 添加`InteractionPrompt`脚本
3. 配置TextMeshPro组件显示提示文本
4. 将预制件拖拽到复活点的Interaction Prompt字段

## 使用方法

### 玩家交互
1. 玩家靠近未激活的复活点（在交互范围内）
2. 出现"按 E 键激活复活点"提示
3. 按E键激活复活点
4. 复活点开始播放动画并成为可用的复活点

### 复活机制
1. 玩家死亡时自动复活到最近的已激活复活点
2. 玩家掉落出地图下边界时自动复活
3. 复活时获得短暂的无敌时间（闪烁效果）

## 调试功能

### 管理器调试
- 在Inspector中查看总复活点数量和已激活数量
- 控制台输出详细的复活点状态信息

### 复活点调试
- 在Scene视图中显示交互范围（黄色球体）
- 显示复活位置（绿色/红色方块）
- 右键菜单测试功能：
  - "测试激活动画"
  - "测试停用动画"
  - "重置动画"

### 动画控制器调试
- 实时显示动画状态信息
- 监控动画播放进度

### 系统测试器（RespawnSystemTester）
添加`RespawnSystemTester`脚本到场景中的任意对象可以进行快速测试：

**测试按键：**
- `K` 键：测试玩家死亡
- `R` 键：强制复活
- `F` 键：测试掉落边界

**右键菜单测试：**
- "测试玩家死亡"
- "测试强制复活" 
- "测试掉落边界"
- "查找玩家"

**显示信息：**
- 游戏运行时在屏幕左上角显示测试说明
- Inspector中显示玩家状态和复活点统计

## 高级配置

### 自定义复活逻辑
可以通过修改`RespawnManager`脚本来实现：
- 不同的复活点选择算法
- 特殊的复活条件
- 复活时的额外效果

### 动画自定义
可以通过修改`TrapRespawnPointAnimator`脚本来实现：
- 不同的动画状态切换逻辑
- 自定义动画播放速度
- 额外的视觉效果

### 扩展功能
- 复活点等级系统
- 复活点解锁条件
- 复活点传送功能
- 复活点保存系统

## 常见问题

### Q: 复活点不响应E键
A: 检查以下项目：
- 玩家是否有"Player"标签
- 复活点的Collider2D是否设为触发器
- 交互范围是否足够大
- 控制台是否有错误信息

### Q: 动画不播放
A: 检查以下项目：
- Animator Controller是否正确配置
- 动画名称是否匹配
- 触发器名称是否正确
- 动画速度是否为0

### Q: 复活位置不正确
A: 检查以下项目：
- Respawn Offset设置
- 复活点的Transform位置
- 地图碰撞体设置

### Q: 掉落检测不工作
A: 检查以下项目：
- Map Bottom Boundary设置是否正确
- 玩家是否正确注册到管理器
- RespawnManager是否在场景中

## 性能优化建议

1. 限制同时存在的复活点数量
2. 使用对象池管理特效和提示UI
3. 合理设置调试信息的显示
4. 优化动画控制器的复杂度

## 版本信息

- 版本：1.0
- 创建时间：[当前时间]
- 兼容Unity版本：2021.3+
- 依赖：TextMeshPro 