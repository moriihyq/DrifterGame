# CollidableTileBreaker 可破坏Collideable瓦片系统使用指南

## 概述
`CollidableTileBreaker` 是一个全新设计的系统，专门为 Tilemap 中的 collideable 瓦片添加可被角色普攻打破的特性。该系统完全独立，不依赖任何现有脚本。

## 功能特点

### ✅ 核心功能
- **自动攻击检测**: 监听多种攻击输入（鼠标、键盘、手柄）
- **智能瓦片定位**: 自动查找和锁定 Collideable Tilemap
- **耐久度系统**: 支持多次攻击才能破坏的瓦片
- **范围攻击**: 可调节的攻击检测范围

### ✨ 视觉效果
- **粒子效果**: 破坏时产生可自定义的碎片粒子
- **渐隐动画**: 碎片带有渐隐消失效果
- **颜色自定义**: 可设置碎片颜色匹配瓦片材质

### 🔊 音效系统
- **多音效支持**: 支持多个破坏音效随机播放
- **音量控制**: 独立的音效音量设置
- **自动音频源**: 自动创建和管理 AudioSource 组件

### 🎁 掉落系统
- **物品掉落**: 破坏瓦片时可掉落指定物品
- **概率控制**: 可调节掉落概率
- **多物品支持**: 支持多种掉落物随机选择

### 🛠️ 调试功能
- **可视化范围**: Scene 视图中显示攻击检测范围
- **详细日志**: 可选的详细调试信息输出
- **运行时测试**: 编辑器中提供测试按钮

## 快速开始

### 第一步：添加脚本
1. 在场景中创建一个空的 GameObject（或使用现有对象）
2. 将 `CollidableTileBreaker.cs` 脚本添加到该对象上

### 第二步：配置 Tilemap
1. 在 Inspector 中点击 **"自动查找Collideable Tilemap"** 按钮
2. 如果自动查找失败，手动将 Collideable Tilemap 拖入对应字段

### 第三步：调整设置
1. **瓦片耐久度**: 设置瓦片需要多少次攻击才能破坏（默认 1 次）
2. **攻击检测范围**: 调整攻击影响范围（默认 2.5 单位）
3. **玩家图层**: 确保正确设置玩家所在的图层

### 第四步：测试运行
1. 运行游戏
2. 使用以下任一方式攻击：
   - 鼠标左键
   - 左 Ctrl 键
   - Z 键或 X 键
   - Fire1 输入（如果已配置）

## 详细配置

### 瓦片破坏设置
```
Collideable瓦片图: 要破坏的 Tilemap 对象
瓦片耐久度: 瓦片的血量（1-10 推荐）
攻击检测范围: 攻击影响范围（1.0-5.0 推荐）
玩家图层: 玩家对象所在的图层遮罩
```

### 破坏效果设置
```
启用破坏效果: 是否显示粒子效果
碎片颜色: 粒子的颜色（建议与瓦片颜色匹配）
碎片数量: 每次破坏产生的粒子数量（5-15 推荐）
碎片速度: 粒子的初始速度（3-8 推荐）
碎片存在时间: 粒子的生命周期（0.5-2.0 秒推荐）
```

### 音效设置
```
破坏音效数组: 拖入破坏音效文件（.wav, .mp3, .ogg）
音效音量: 播放音量（0.0-1.0）
```

### 掉落设置
```
启用掉落: 是否在破坏时掉落物品
掉落物预制体: 可掉落的物品预制体数组
掉落概率: 掉落几率（0.0-1.0，0.3 表示 30% 概率）
```

## 支持的输入方式

系统会自动检测以下攻击输入：

1. **Fire1 按钮** (如果在 Input Manager 中已配置)
2. **鼠标左键** (Mouse Button 0)
3. **左 Ctrl 键** (Left Control)
4. **Z 键** (KeyCode.Z)
5. **X 键** (KeyCode.X)

## 玩家对象检测

系统会按以下优先级查找玩家对象：

1. 带有 "Player" 标签的对象
2. 名称为 "Player" 的对象
3. 属于指定玩家图层的对象
4. 名称包含 "player" 的对象

## 高级功能

### 代码调用示例

```csharp
// 获取系统引用
CollidableTileBreaker breaker = FindObjectOfType<CollidableTileBreaker>();

// 直接破坏指定位置的瓦片
breaker.BreakTileAtPosition(worldPosition);

// 破坏指定范围内的所有瓦片
breaker.BreakTilesInRange(centerPosition, radius);

// 动态设置参数
breaker.SetTileHitPoints(3); // 设置瓦片耐久度为 3
breaker.SetAttackRange(4.0f); // 设置攻击范围为 4 个单位
```

### 自定义扩展

您可以通过修改脚本来添加更多功能：

1. **不同瓦片类型**: 为不同瓦片设置不同的耐久度
2. **攻击效果**: 添加攻击时的视觉反馈
3. **音效变化**: 根据瓦片类型播放不同音效
4. **特殊掉落**: 根据瓦片位置或类型掉落特定物品

## 故障排除

### 常见问题

**Q: 攻击没有反应**
A: 检查以下项目：
- 确保已正确设置 Collideable Tilemap
- 检查玩家对象是否被正确识别
- 确认攻击检测范围是否足够大
- 查看控制台是否有错误信息

**Q: 找不到 Collideable Tilemap**
A: 
- 确保 Tilemap 名称包含 "collideable"、"collision" 或 "wall"
- 手动将正确的 Tilemap 拖入脚本字段
- 检查 Tilemap 对象是否处于激活状态

**Q: 粒子效果不显示**
A:
- 检查 "启用破坏效果" 是否已勾选
- 确认粒子数量大于 0
- 检查粒子颜色是否为透明

**Q: 音效不播放**
A:
- 确保已添加音效文件到数组中
- 检查音效音量是否大于 0
- 确认 AudioSource 组件正常工作

### 性能优化建议

1. **合理设置检测范围**: 避免过大的攻击检测范围
2. **控制粒子数量**: 大量粒子可能影响性能
3. **音效预加载**: 将常用音效设为预加载
4. **对象池化**: 对于频繁掉落的物品，考虑使用对象池

## 更新日志

### v1.0.0
- 初始版本发布
- 基础破坏功能
- 粒子效果系统
- 音效支持
- 掉落物系统
- 编辑器集成

## 技术支持

如果您在使用过程中遇到问题：

1. 首先查看控制台的调试信息
2. 检查 "记录调试信息" 选项是否已启用
3. 在编辑器中使用运行时测试功能进行调试
4. 确保所有相关组件和资源都正确配置

---

**注意**: 此系统专为 Unity 2D 游戏设计，使用 Tilemap 和 Tilemap Collider 2D 组件。确保您的项目正确配置了这些组件。 